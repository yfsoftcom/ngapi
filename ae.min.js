"use strict";!function(){function t(t){var e=[];for(var i in t)e.push(i);e=e.sort();var o=[];e.forEach(function(e){var i=t[e];_.isObject(i)&&(i=JSON.stringify(i)),o.push(e+"="+encodeURIComponent(i))});var r=o.join("&"),n=md5(r);return n}var e={Object:{CREATE_ERROR:{errno:-1,code:"CREATE_ERROR",message:"create function should be called by a new object"},SAVE_ERROR:{errno:-2,code:"SAVE_ERROR",message:"save function should be called behind get or create"},REMOVE_ERROR:{errno:-3,code:"REMOVE_ERROR",message:"remove function should be called behind get or create"},OBJECT_ID_NOT_FIND:{errno:-4,code:"OBJECT_ID_NOT_FIND",message:"Object does not find by id or more rows"}}},i={DEV:"http://localhost:8080",STAGING:"http://61.147.98.134:8080",PRODUCT:"http://api.guoran100.com:9001"};angular.module("ngApi",[]).factory("$ae",["$q","$http",function(o,r){var n={mode:"DEV",appkey:"",masterKey:""},s="http://localhost:8080",c=function(e,i){var c=o.defer();delete i.scope;var h={method:e,appkey:n.appkey,masterKey:n.masterKey,timestamp:_.now(),param:i},a=t(h);return h.sign=a,delete h.masterKey,r.post(s+"/api",h).success(function(t){0===t.errno?c.resolve(t.data):c.reject(t)}).error(function(t){c.reject(t)}),c.promise},h=function(t,e){if(!_.isString(t))throw new Error("Object Class should be String");this._t=t,this._d=e||{},this.objectId=this._d.id||void 0};h.prototype.toJson=function(){return this._d},h.prototype.print=function(){console.log("id="+this.objectId),console.log("createAt="+this._d.createAt),console.log("updateAt="+this._d.updateAt),console.log("data="+JSON.stringify(this._d))},h.prototype.set=function(t,e){return _.isObject(t)?this._d=_.extend(this._d,t):this._d[t]=e,this},h.prototype.get=function(t){return t?this._d[t]:this._d},h.prototype.getById=function(t){var e=o.defer();this.objectId=t;var i=this,r={table:this._t,id:t};return c("api.get",r).then(function(t){i._d=t,e.resolve(i)})["catch"](function(t){e.reject(t)}),e.promise},h.prototype.save=function(t){var i=o.defer();if(void 0===this.objectId)return i.reject(e.Object.SAVE_ERROR),i.promise;t&&(this._d=t),this._d.updateAt=(new Date).getTime();var r=this,n={table:this._t,condition:" id = "+this.objectId,row:this._d};return c("api.update",n).then(function(){i.resolve(r)})["catch"](function(t){i.reject(t)}),i.promise},h.prototype.remove=function(){var t=o.defer();if(void 0===this.objectId)return t.reject(e.Object.REMOVE_ERROR),t.promise;var i={table:this._t,id:this.objectId};return c("api.remove",i).then(function(){t.resolve(1)})["catch"](function(e){t.reject(e)}),t.promise},h.prototype.create=function(t){var i=o.defer();if(void 0!==this.objectId)return i.reject(e.Object.CREATE_ERROR),i.promise;t&&(this._d=t),this._d.updateAt=this._d.createAt=(new Date).getTime();var r=this,n={table:this._t,row:this._d};return c("api.create",n).then(function(t){r.objectId=t.insertId,r._d.id=r.objectId,i.resolve(r)})["catch"](function(t){i.reject(t)}),i.promise};var a=function(t){if(!_.isString(t))throw new Error("Class should be String");this._t=t,this._s="id-",this._l=100,this._k=0,this._c=" 1=1 ",this._f="*"};a.prototype.sort=function(t){return this._s=t,this},a.prototype.page=function(t,e){return this._l=e||100,this._k=(t-1)*this._l,this},a.prototype.condition=function(t){return this._c=t,this},a.prototype.and=function(t){return this._c=this._c+" and "+t,this},a.prototype.or=function(t){return this._c=this._c+" or "+t,this},a.prototype.select=function(t){return _.isString(t)&&(t=t.split(",")),_.contains(t,"id")||t.push("id"),_.contains(t,"createAt")||t.push("createAt"),_.contains(t,"updateAt")||t.push("updateAt"),t=t.join(","),this._f=t,this},a.prototype.count=function(){var t=o.defer(),e={table:this._t,condition:this._c};return c("api.count",e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise},a.prototype.findAndCount=function(){var t=o.defer(),e=this,i={table:this._t,condition:this._c,sort:this._s,limit:this._l,skip:this._k,fields:this._f};return c("api.findAndCount",i).then(function(i){var o=[];_.isEmpty(i)||_.each(i.rows,function(t){var i=new h(e._t,t);o.push(i)}),i.rows=o,t.resolve(i)})["catch"](function(e){t.reject(e)}),t.promise},a.prototype.first=function(){var t=o.defer(),e=this,i={table:this._t,condition:this._c,sort:this._s,limit:this._l,skip:this._k,fields:this._f};return c("api.first",i).then(function(i){var o;_.isArray(i)?0===i.length&&(o=new h(e._t),t.resolve(o)):_.isObject(i)&&(o=new h(e._t,i),t.resolve(o))})["catch"](function(e){t.reject(e)}),t.promise},a.prototype.find=function(){var t=o.defer(),e=this,i={table:this._t,condition:this._c,sort:this._s,limit:this._l,skip:this._k,fields:this._f};return c("api.find",i).then(function(i){var o=[];_.isEmpty(i)||_.each(i,function(t){var i=new h(e._t,t);o.push(i)}),t.resolve(o)})["catch"](function(e){t.reject(e)}),t.promise},a.prototype.clear=function(){var t=o.defer(),e={table:this._t,condition:this._c};return c("api.clear",e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise};var u=function(t){this._f=t};return u.prototype.invoke=function(t){var e=o.defer();return c(this._f,t).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)}),e.promise},{init:function(t){t=t||{};for(var e in t)n[e]=t[e];s=i[n.mode]},Object:h,Query:a,Function:u}}])}();